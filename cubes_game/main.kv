<CubesGame>:
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .35
#            height: WINDOW.height - (rl.height + (WINDOW.width / 6) *2)  # * 3)
            canvas:
                Color:
                    rgba: (.36, .17, .05, 1)
                Rectangle:
                    size: self.size
                    pos: self.pos
            StackLayout: # status board
                size_hint_y: None
                height: WINDOW.width / 6
                canvas:
                    Color:
                        rgba: (.30, .12, .03, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                Button:
                    text: '<<back'
                    size_hint_x: .2
                    color: (1, .5, 0, 1)
                    background_normal: ''
                    background_color: (.30, .12, .03, 1)
                    on_press: root.dismiss()
                Button:
                    border: [0, 0, 0, 0]
                    size_hint: None, None
                    size: WINDOW.width / 6, WINDOW.width / 6
                    background_normal: 'images/crystal.png'
                    background_down: 'images/crystal.png'
                    on_press: root.open_shop()

            BoxLayout:
                RelativeLayout:
                    size_hint_x: .65
                    BoxLayout:
                        padding: (WINDOW.width/40, WINDOW.width/40)
                        Label:
                            text: 'Score: '
                            color: (1, .5, 0, 1)
                        Label:
                            id: score_label
                            color: (1, .5, 0, 1)
                        Label:
                            text: 'Swipe: '
                            color: (1, .5, 0, 1)
                        Label:
                            id: swipes_label
                            color: (1, .5, 0, 1)
                RelativeLayout:
                    size_hint_x: .35
                    Character:
                        id: character
                    CharacterLevelButton:
                        id: character_level
                        size_hint: None, None
                        size: WINDOW.width / 15, WINDOW.width / 15
                        on_press: self.open_character_level_info(character.name)
                    ProgressBar:


        BoxLayout:
            orientation: 'vertical'
            size_hint_y: .65
#            height: rl.height + (WINDOW.width / 6) * 2
            AnchorLayout:
                size_hint_y: .15
#                height: WINDOW.width / 6
                canvas:
                    Color:
                        rgba: (.30, .12, .03, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                BoxLayout:
                    id: skills
                    size_hint_x: None
                    width: self.minimum_width
                    spacing: WINDOW.width / 20
                    padding: WINDOW.width / 30
            AnchorLayout:
                size_hint_y: .85
#                height: rl.height + WINDOW.width / 6
                canvas:
                    Color:
                        rgba: (.36, .17, .05, 1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                anchor_x: 'center'
                anchor_y: 'center'
                RelativeLayout:
                    id: rl
                    size_hint: None, None
                    StencilView: # field with cubes
                        id: playing_field
                        canvas:
                            Color:
                                rgba: (.30, .12, .03, 1)
                            Rectangle:
                                size: self.size
                                pos: self.pos

<Character>:
    on_press: root.open_character_changer()
    border: [0, 0, 0 ,0]

<Character2>:
    on_press: root.open_character_changer(change_skills=False)
    border: [0, 0, 0 ,0]

<SkillBox>:
    size_hint_x: None
    width: self.height
    RelativeLayout:
        Skill:
            id: skill
            quantity: 0
        Label:
            id: quantity
            text: str(skill.quantity)
            size_hint: None, None
            size: self.texture_size
            x: skill.x - self.width / 2
            y: skill.y - self.height / 2
            color: (1, 1, 1, 1)
            canvas.before:
                Color:
                    rgba: (.49, .42, .88, 1)
                Ellipse:
                    pos: self.center_x - self.height / 2, self.y
                    size: self.height, self.height

<Skill>:
    border: [0, 0, 0, 0]
    background_down: self.background_normal
    background_color: (0, 0, 0, 1)
    on_state: self.change_color()
    c: (.88, .72, .31, 1)
    canvas.before:
        Color:
            rgba: self.c
        RoundedRectangle:
            size: self.size[0] * 1.2, self.size[1] * 1.2
            pos: self.pos[0] - self.size[0] * .1, self.pos[1] - self.size[1] * .1
            radius: [self.height / 5,]

<CharacterChanger>:
    size_hint_y: WINDOW.width / WINDOW.height / 3
    size_hint_x: .8
    background: ''
    canvas:
        Color:
            rgba: (.30, .12, .03, 1)
        Rectangle:
            size: self.size
            pos: self.pos
    GridLayout:
        id: character_selection
        cols: 3
        spacing: WINDOW.width / 60
        padding: WINDOW.width / 60



<StartingPoint>:
    size_hint: None, None
    canvas:
        Ellipse:
            pos: self.pos
            size: self.size
        Color:
            rgba: 1, 0, 0, 1

<GameEnding>:
    size_hint: .8, .8
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: lbl
            text: 'GG! Your score is: 0'
        Label:
            id: stars
        BoxLayout:
            BoxLayout:
                size_hint_x: .6
                orientation: 'vertical'
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'exp: '
                    Label:
                        id: exp
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'crystal fragments: '
                    Label:
                        id: crystal_fragments
            Character2:
                id: character
                size_hint_x: .4
        Button:
            text: 'Play again'
            on_press: root.play_again()
        Button:
            text: 'Exit'
            on_press: root.exit_level()

<Cube>:
    border: (0, 0, 0, 0)

<CharacterLevelButton>:
    background_color: (0, 0, 0, 0)
    canvas.before:
        Color:
            rgba: (1, 0, 0, 1)
        Ellipse:
            pos: self.pos
            size: self.size
    background_normal: ''
    background_down: ''
    text: ''


<CharacterLevelInfo>:
    size_hint: .8, .3
    BoxLayout:
        Label:
            id: character_level
        Label:
            id: exp